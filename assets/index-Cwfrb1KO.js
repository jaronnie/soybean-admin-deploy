import{_ as oe,N as re,b as ue}from"./table-header-operation.vue_vue_type_script_setup_true_lang-B-66uQft.js";import{d as V,aM as j,aN as K,a as H,$ as l,p as pe,r as ie,am as me,o as x,c as T,w as n,f as a,g as B,t as M,h as e,b as I,s as A,F as L,x as J,aO as Q,B as F,be as de,bf as ce,bg as W,L as X,C as _e,aT as $,N as q,aU as ge}from"./index-DTCgPdtS.js";import{n as Y,e as Z,f as fe,b as ve,_ as he,u as be,c as Ne,o as ye,p as ke,h as we,i as xe}from"./business-CPyYCHyR.js";import{u as ee,a as ae,_ as Re,b as le}from"./form-Bz89uGRS.js";import{_ as ne}from"./Space-BxRv4wJm.js";import{_ as Se,a as Ue,b as Ge,c as Pe}from"./round-refresh-CF773-bN.js";import{a as De}from"./Grid-U6nXC8v0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BqCnbI-a.js";const Ce=V({name:"UserOperateDrawer",__name:"user-operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(b,{emit:P}){const N=b,k=P,f=K(b,"visible"),{formRef:R,validate:m,restoreValidation:S}=ee(),{defaultRequiredRule:U}=ae(),w=H(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[N.operateType]),o=pe(i());function i(){return{userName:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null}}const y={userName:U,status:U},c=ie([]);async function G(){const{error:v,data:u}=await fe();if(!v){const h=u.map(s=>({label:s.roleName,value:s.roleCode})),d=o.userRoles.map(s=>({label:s,value:s}));c.value=[...d,...h]}}function D(){Object.assign(o,i()),N.operateType==="edit"&&N.rowData&&Object.assign(o,N.rowData)}function _(){f.value=!1}async function C(){var v;await m(),(v=window.$message)==null||v.success(l("common.updateSuccess")),_(),k("submitted")}return me(f,()=>{f.value&&(D(),S(),G())}),(v,u)=>{const h=J,d=Re,s=he,p=ve,t=Q,z=le,E=F,g=ne,te=de,se=ce;return x(),T(se,{show:f.value,"onUpdate:show":u[7]||(u[7]=r=>f.value=r),"display-directive":"show",width:360},{default:n(()=>[a(te,{title:w.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(g,{size:16},{default:n(()=>[a(E,{onClick:_},{default:n(()=>[B(M(e(l)("common.cancel")),1)]),_:1}),a(E,{type:"primary",onClick:C},{default:n(()=>[B(M(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(z,{ref_key:"formRef",ref:R,model:o,rules:y},{default:n(()=>[a(d,{label:e(l)("page.manage.user.userName"),path:"userName"},{default:n(()=>[a(h,{value:o.userName,"onUpdate:value":u[0]||(u[0]=r=>o.userName=r),placeholder:e(l)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userGender"),path:"userGender"},{default:n(()=>[a(p,{value:o.userGender,"onUpdate:value":u[1]||(u[1]=r=>o.userGender=r)},{default:n(()=>[(x(!0),I(L,null,A(e(Y),r=>(x(),T(s,{key:r.value,value:r.value,label:e(l)(r.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.nickName"),path:"nickName"},{default:n(()=>[a(h,{value:o.nickName,"onUpdate:value":u[2]||(u[2]=r=>o.nickName=r),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userPhone"),path:"userPhone"},{default:n(()=>[a(h,{value:o.userPhone,"onUpdate:value":u[3]||(u[3]=r=>o.userPhone=r),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userEmail"),path:"email"},{default:n(()=>[a(h,{value:o.userEmail,"onUpdate:value":u[4]||(u[4]=r=>o.userEmail=r),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userStatus"),path:"status"},{default:n(()=>[a(p,{value:o.status,"onUpdate:value":u[5]||(u[5]=r=>o.status=r)},{default:n(()=>[(x(!0),I(L,null,A(e(Z),r=>(x(),T(s,{key:r.value,value:r.value,label:e(l)(r.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userRole"),path:"roles"},{default:n(()=>[a(t,{value:o.userRoles,"onUpdate:value":u[6]||(u[6]=r=>o.userRoles=r),multiple:"",options:c.value,placeholder:e(l)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ee=V({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(b,{emit:P}){const N=P,{formRef:k,validate:f,restoreValidation:R}=ee(),m=K(b,"model"),S=H(()=>{const{patternRules:o}=ae();return{userEmail:o.email,userPhone:o.phone}});async function U(){await R(),N("reset")}async function w(){await f(),N("search")}return(o,i)=>{const y=J,c=oe,G=Q,D=Se,_=F,C=Ue,v=ne,u=De,h=le,d=Ge,s=Pe,p=X;return x(),T(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(s,null,{default:n(()=>[a(d,{title:e(l)("common.search"),name:"user-search"},{default:n(()=>[a(h,{ref_key:"formRef",ref:k,model:m.value,rules:S.value,"label-placement":"left","label-width":80},{default:n(()=>[a(u,{responsive:"screen","item-responsive":""},{default:n(()=>[a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userName"),path:"userName",class:"pr-24px"},{default:n(()=>[a(y,{value:m.value.userName,"onUpdate:value":i[0]||(i[0]=t=>m.value.userName=t),placeholder:e(l)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:n(()=>[a(G,{value:m.value.userGender,"onUpdate:value":i[1]||(i[1]=t=>m.value.userGender=t),placeholder:e(l)("page.manage.user.form.userGender"),options:e(W)(e(Y)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:n(()=>[a(y,{value:m.value.nickName,"onUpdate:value":i[2]||(i[2]=t=>m.value.nickName=t),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:n(()=>[a(y,{value:m.value.userPhone,"onUpdate:value":i[3]||(i[3]=t=>m.value.userPhone=t),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:n(()=>[a(y,{value:m.value.userEmail,"onUpdate:value":i[4]||(i[4]=t=>m.value.userEmail=t),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:n(()=>[a(G,{value:m.value.status,"onUpdate:value":i[5]||(i[5]=t=>m.value.status=t),placeholder:e(l)("page.manage.user.form.userStatus"),options:e(W)(e(Z)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[a(v,{class:"w-full",justify:"end"},{default:n(()=>[a(_,{onClick:U},{icon:n(()=>[a(D,{class:"text-icon"})]),default:n(()=>[B(" "+M(e(l)("common.reset")),1)]),_:1}),a(_,{type:"primary",ghost:"",onClick:w},{icon:n(()=>[a(C,{class:"text-icon"})]),default:n(()=>[B(" "+M(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function O(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!ge(b)}const Ae=V({name:"manage_user",__name:"index",setup(b){const P=_e(),{columns:N,columnChecks:k,data:f,getData:R,getDataByPage:m,loading:S,mobilePagination:U,searchParams:w,resetSearchParams:o}=be({apiFn:ye,showTotal:!0,apiParams:{current:1,size:10,status:null,userName:null,userGender:null,nickName:null,userPhone:null,userEmail:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"userName",title:l("page.manage.user.userName"),align:"center",minWidth:100},{key:"userGender",title:l("page.manage.user.userGender"),align:"center",width:100,render:s=>{if(s.userGender===null)return null;const p={1:"primary",2:"error"},t=l(ke[s.userGender]);return a(q,{type:p[s.userGender]},O(t)?t:{default:()=>[t]})}},{key:"nickName",title:l("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:l("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:l("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:l("page.manage.user.userStatus"),align:"center",width:100,render:s=>{if(s.status===null)return null;const p={1:"success",2:"warning"},t=l(we[s.status]);return a(q,{type:p[s.status]},O(t)?t:{default:()=>[t]})}},{key:"operate",title:l("common.operate"),align:"center",width:130,render:s=>{let p;return a("div",{class:"flex-center gap-8px"},[a(F,{type:"primary",ghost:!0,size:"small",onClick:()=>d(s.id)},O(p=l("common.edit"))?p:{default:()=>[p]}),a(re,{onPositiveClick:()=>h(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let t;return a(F,{type:"error",ghost:!0,size:"small"},O(t=l("common.delete"))?t:{default:()=>[t]})}})])}}]}),{drawerVisible:i,operateType:y,editingData:c,handleAdd:G,handleEdit:D,checkedRowKeys:_,onBatchDeleted:C,onDeleted:v}=Ne(f,R);async function u(){console.log(_.value),C()}function h(s){console.log(s),v()}function d(s){D(s)}return(s,p)=>{const t=ue,z=xe,E=X;return x(),I("div",$e,[a(Ee,{model:e(w),"onUpdate:model":p[0]||(p[0]=g=>$(w)?w.value=g:null),onReset:e(o),onSearch:e(m)},null,8,["model","onReset","onSearch"]),a(E,{title:e(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(t,{columns:e(k),"onUpdate:columns":p[1]||(p[1]=g=>$(k)?k.value=g:null),"disabled-delete":e(_).length===0,loading:e(S),onAdd:e(G),onDelete:u,onRefresh:e(R)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[a(z,{"checked-row-keys":e(_),"onUpdate:checkedRowKeys":p[2]||(p[2]=g=>$(_)?_.value=g:null),columns:e(N),data:e(f),size:"small","flex-height":!e(P).isMobile,"scroll-x":962,loading:e(S),remote:"","row-key":g=>g.id,pagination:e(U),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ce,{visible:e(i),"onUpdate:visible":p[3]||(p[3]=g=>$(i)?i.value=g:null),"operate-type":e(y),"row-data":e(c),onSubmitted:e(m)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Ae as default};
